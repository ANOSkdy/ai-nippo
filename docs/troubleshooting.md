# トラブルシューティングガイド

## 症状別チェックリスト

### 1. ログインできない / 「ログインが必要です」と表示される
- **画面での見え方**: ErrorBanner が黄色で「ログインに失敗しました」「ログインが必要です」と表示。
- **自分でできる対処**:
  - 入力した ID / パスワードが正しいか再確認する。
  - Caps Lock が無効になっているか確認する。
  - ブラウザのプライベートモードを解除し、通常モードで試す。
- **それでもダメな時**:
  - 管理者へアカウントロックの解除を依頼。
  - 認証システム（NextAuth）の障害状況を共有。
- <!-- screenshot: screenshots/login-error.png -->

### 2. NFC打刻画面で「登録されていない機械IDです」
- **画面での見え方**: エラー表示（黄色）で再読み取りの案内。
- **自分でできる対処**:
  - 別のタグを読み取り、ID が変化するか確認。
  - スマホ端末の NFC をオンにする。
- **それでもダメな時**:
  - 現場の担当者に機械IDの登録状況を確認してもらう。
  - Airtable の Machines テーブルに該当レコードが存在するか運用チームに確認依頼。
- <!-- screenshot: screenshots/nfc-invalid-machine.png -->

### 3. 「位置情報の取得に失敗しました」
- **画面での見え方**: 赤い ErrorBanner に詳細トグルが表示。
- **自分でできる対処**:
  - ブラウザの位置情報許可設定を「許可」に変更する。
  - 屋外へ移動、Wi-Fi を有効化するなど受信環境を改善。
  - 端末の GPS を一度オフ→オンでリセット。
- **それでもダメな時**:
  - IT 管理者に端末のポリシー設定（MDM）を確認してもらう。
  - ネットワーク遅延が大きい場合は後ほど再試行するよう現場へ周知。
- <!-- screenshot: screenshots/location-error.png -->

### 4. 「アクセスが集中しています」(429)
- **画面での見え方**: 黄色の ErrorBanner に待機案内が表示され、再試行ボタンが有効。
- **自分でできる対処**:
  - 表示された待ち時間（60秒目安）を経過してから再試行。
  - 同僚と操作タイミングをずらす。
- **それでもダメな時**:
  - 運用チームが Airtable のレート制限状況を確認し、バッチ処理へ切替を検討。
  - 障害情報がある場合は全社連絡で周知。
- <!-- screenshot: screenshots/rate-limit.png -->

### 5. 「サーバーで問題が発生しました」(500)
- **画面での見え方**: 赤色の ErrorBanner、詳細トグルでエラー識別子が表示。
- **自分でできる対処**:
  - 画面右上の「再試行」ボタンを押す。
  - ブラウザを再読み込みし、再ログインを試す。
- **それでもダメな時**:
  - 運用チームへ発生時間・表示されたエラーコードを共有。
  - 監視ダッシュボードで該当の `APP-500-*` / `EXT-AIRTABLE-*` ログを確認。
- <!-- screenshot: screenshots/server-error.png -->

### 6. 空の打刻一覧が表示される
- **画面での見え方**: 正常表示だがデータが空。ErrorBanner は表示されない。
- **自分でできる対処**:
  - 当日の出勤打刻が完了しているか確認。
  - フィルタ条件（作業内容など）を変更して再取得。
- **それでもダメな時**:
  - Airtable Logs テーブルに該当ユーザーのデータが存在するか運用側に確認。
  - 連携バッチ（out-to-session API）の実行状況を点検。
- <!-- screenshot: screenshots/empty-state.png -->

### 7. 認証後に白画面になる
- **画面での見え方**: ErrorBanner が表示されず白画面またはグローバルエラーページへ遷移。
- **自分でできる対処**:
  - ブラウザのキャッシュを削除して再アクセス。
  - 別ブラウザでの再現確認。
- **それでもダメな時**:
  - 管理者に `APP-500-GLOBAL` ログ有無を確認依頼。
  - デプロイ直後であればロールバックを検討。
- <!-- screenshot: screenshots/global-error.png -->

## 分岐フロー
1. 画面に ErrorBanner が出ているか？
   - **はい**: 表示された文言の「次のアクション」に従う。
   - **いいえ**: ブラウザコンソールのエラーとネットワークタブを確認し、オフライン/白画面の場合はキャッシュクリア。
2. 再試行で解決したか？
   - **はい**: 一過性のため記録のみ。
   - **いいえ**: 表示されたエラーコードを添えて運用チームへ報告。

## 連絡先テンプレート
- 件名: 【スマレポ】<日付> <エラーコード> 発生
- 本文: 
  - 発生日時 / 画面名
  - 症状 (ErrorBanner 文言)
  - 操作手順
  - 添付: スクリーンショット, ネットワークログ

## 付録: よくある質問
- **Q. 429 エラーが頻発する** → 夜間のバッチ時間帯に集中しやすいため、アクセス時間の分散を検討してください。
- **Q. 位置情報が不正確** → 端末側で GPS 省電力モードを解除すると改善します。
- **Q. ログイン後すぐに切断される** → Cookie ブロック設定を確認し、`*.vercel.app` を許可してください。
