# Next.js/React RSC 脆弱性監査レポート（CVE-2025-55182 / CVE-2025-66478）

## 1. Overview
- 対象: ai-nippo（Next.js + TypeScript、Airtable REST をサーバーサイドのみで利用）。
- 目的: React Server Components (RSC) に関する既知脆弱性の影響有無を静的に確認するリードオンリー監査。
- 脆弱性概要: RSC が想定外にキャッシュ共有/再利用されることで他ユーザーのデータが混入する可能性がある問題（CVE-2025-55182 / CVE-2025-66478）。

## 2. Detected Stack
- パッケージマネージャー: pnpm（`pnpm-lock.yaml` を確認）。
- Node ランタイム: Next.js のデフォルト Node Runtime を想定（Edge 指定なし）。
- 主要パッケージバージョン:
  - next: 15.5.2
  - react: 19.1.0
  - react-dom: 19.1.0
  - react-server-dom-* 系: なし（依存関係とロックファイルを検索して未検出）。

## 3. RSC & App Router Usage
- App Router: `app/` ディレクトリ配下でレイアウト・ページを構成しており、App Router を採用。
- RSC: `app/layout.tsx` などデフォルトがサーバーコンポーネントとして実装され、`use client` 明示なしのため RSC として解釈されるファイルが存在。
- サーバーアクション: `"use server"` 指定はリポジトリ内で未検出。
- データ取得: Airtable へのアクセスはサーバー側で行う構成を前提（クライアント側での Airtable 呼び出しは確認されず）。

## 4. Risk Assessment
- 脆弱範囲: React 19.0.x / Next 15.0.x〜15.4.x を中心に RSC のキャッシュ混線が報告されたレンジ。
- 現行バージョン: React 19.1.0 と Next 15.5.2 は、公式の修正リリース（19.1 系 / 15.5 系）に該当。
- 判定: 現行バージョンは既に修正版レンジにあるため、既知の RSC 漏洩脆弱性の直接影響は低い。ただし、依存の一貫性維持と将来の累積修正を取り込むため、継続的なアップデートは推奨。

## 5. Upgrade Recommendation
- 最小アップグレード（安定維持優先）
  - next: 15.5.x の最新パッチ（例: 15.5.3 以降が出ていれば追従）。
  - react / react-dom: 19.1.x の最新パッチ。
- 追加確認
  - 依存に react-server-dom-* が新規追加される場合は、同メジャーの最新パッチを採用し、RSC 用 API の互換性を確保。
  - Node 20 LTS での検証を推奨（Vercel/CI のデフォルトと整合）。

## 6. Checklist for Next Steps
1. `package.json` の next / react / react-dom を 15.5.x / 19.1.x の最新パッチへ更新。
2. `pnpm install`（または `pnpm update`）でロックファイルを再生成。
3. `pnpm lint` / `pnpm test` / `pnpm build` を実行し、RSC/SSR が正常に動作することを確認。
4. GitHub → Vercel の Preview デプロイで主要フロー（認証、Airtable 連携、レポート表示/印刷）を手動確認。
5. 本番反映後にキャッシュ・権限まわりのログを一時的に強化し、異常レスポンスがないことをモニタリング。
